# Implementation Plan - Project Optimization & Refactoring

This plan outlines the steps to overhaul the Fund Advisor project, improving its reliability, performance, and feature set while removing low-value or harmful components.

## Proposed Changes

### Phase 1: Cleanup & Deletion
Remove redundant, flawed, or misleading features and code.

#### [DELETE] [prediction_service.py](file:///d:/fund-advisor/backend/services/prediction_service.py)
#### [DELETE] [vector_service.py](file:///d:/fund-advisor/backend/services/vector_service.py)
#### [DELETE] [watchlist_service.py](file:///d:/fund-advisor/backend/services/watchlist_service.py)
#### [DELETE] [crawler_worker.py](file:///d:/fund-advisor/backend/scripts/crawler_worker.py)
- Also remove `/admin/build-static` route and `backend/data/storage/` directory.

### Phase 2: Architectural & Stability Improvements
Enhance the core infrastructure for reliability and performance.

- **AI Service Optimization**: Reduce temperature to 0.3, use metric-based cache keys, and remove RAG logic.
- **Cache Management**: Implement LRU limits to prevent OOM.
- **RateLimiting**: Ensure thread-safety for concurrent AkShare requests.
- **Data Integrity**: Replace hardcoded/dummy manager and rank data with real AkShare sources.
- **Macro Data**: Transition `macro_service.py` to real-time sources (CN/US bonds, VIX, USD/CNY).
- **Search Optimization**: Weight search results by fund score and match level.
- **Pinyin Support**: Replace hardcoded dictionaries with `pypinyin` library.
- **Database Migrations**: Add a versioning table for reliable schema updates.
- **Logging**: Implement `RotatingFileHandler` to prevent log file bloat.
- **API Versioning**: Introduce `/api/v1/` prefix for client-facing routes.

### Phase 3: New Feature Development
Add high-impact analytical tools and reports.

- [x] **Fund Health Check**: indicator-based "Green/Yellow/Red" dashboard.
- [x] **Fee Comparison**: Visualize the impact of management and redemption fees.
- [x] **Investment Backtesting**: Simulate DCA and smart entry strategies.
- [x] **Style Analysis**: Detect "Style Drift" and high turnover rates.
- [x] **Investment Calendar**: Aggregated market and fund-specific events. [COMPLETED]

### Phase 5: System Refinement [COMPLETED]
Structural and logical cleanup for production-ready status.

- [x] **Infrastructure Cleanup**: Deleted all 30+ debug scripts from root.
- [x] **Scoring Engine Unification**: Standardized `snapshot.py` to use `calculator.py`.
- [x] **API Surface Exposure**: Registered and exposed all analytical services in `query.py`.
- [x] **Logic Debugging**: Fixed search indentation, health scale, and style symbols.
- [x] **Route Consolidation**: Merged sector prediction into `/metrics`.
- [x] **AI/Cache Refinement**: Lower AI temperature to 0.2; simplified `cache.py`.

### Phase 7: User-Centric Advanced Tools [IN PROGRESS]
Structural and functional bridge for beginner investors.

- **功能一：每日操作清单**
  - 后端：实现 `ActionService` 综合评分、回撤、均线偏离逻辑。
  - 前端：重构 `RecommendView` 或 `HomeView` 显示建议买入/持有/卖出。
- **功能二：一键建仓方案**
  - 后端：映射风险等级到大类资产配比，筛选高分基金。
  - 前端：新增 `PortfolioInitModal` 交互。
- **功能三：定投计划管理**
  - 数据库：新增 `dca_plans` 和 `dca_records` 表。
  - 后端：实现计划 CRUD、提醒逻辑及手动执行确认。
- **功能四：持仓盈亏看板**
  - 后端：新增 `/api/v1/portfolio/summary` 注入实时净值。
  - 前端：重构 `PortfolioView` 顶部汇总。
- **功能五：推荐历史验证**
  - 后端：完善 `/api/v1/recommendations/history` 后续收益计算。
  - 前端：新增 `EvolutionView` 或 `HistoryView`。
- **功能六：买卖操作指引**
  - 数据：从 AkShare 获取渠道、费率、确认时间。
  - 前端：在 `FundDetailModal` 增加操作指引区。
- **功能七：风险提醒与止损通知**
  - 逻辑：实现每日收盘后风险巡检任务。
  - 交互：数据库 `notifications` 表 + 前端提醒中心。
- **功能八：小白知识卡片**
  - 术语：全系统术语映射大白话描述。
  - 教育：问号图标 + 30 字核心指标解释。

## Verification Plan

### Automated Tests
- [ ] 验证 `ActionService` 产生的买卖信号准确性。
- [ ] 模拟 DCA 计划执行并验证记录。
- [ ] 接口测试：`/portfolio/summary` 实时数据注入。

### Manual Verification
- [ ] 检查首页「今日操作清单」的大白话展示。
- [ ] 测试「一键建仓」方案生成的合理性。
- [ ] 验证风险提醒在 15:30 后的生成情况。
- [ ] 确认 Dark Mode 切换的持久化状态。
