# backend/constants.py
"""
ç»Ÿä¸€å¸¸é‡å®šä¹‰ - æ¶ˆé™¤ä»£ç é‡å¤
"""

# ==================== ä¸»é¢˜å›¾æ ‡æ˜ å°„ ====================
THEME_ICONS = {
    # ä¸»æµè¡Œä¸š
    'å¤§æ¶ˆè´¹': 'ğŸ›’', 'ç™½é…’': 'ğŸ·', 'é£Ÿå“é¥®æ–™': 'ğŸ”', 'å®¶ç”µ': 'ğŸ“º', 'ç¾å¦†': 'ğŸ’„', 
    'æ—…æ¸¸é…’åº—': 'ğŸ¨', 'å†œä¸šå…»æ®–': 'ğŸ·',
    
    'ç§‘æŠ€TMT': 'ğŸ’»', 'åŠå¯¼ä½“èŠ¯ç‰‡': 'ğŸ”Œ', 'è®¡ç®—æœº': 'ğŸ’¾', 'ç”µå­': 'ğŸ“±', 
    'é€šä¿¡': 'ğŸ“¡', 'ä¼ åª’æ¸¸æˆ': 'ğŸ®',
    
    'æ–°èƒ½æº': 'âš¡', 'å…‰ä¼': 'â˜€ï¸', 'æ–°èƒ½æºè½¦': 'ğŸš—', 'é£ç”µ': 'ğŸŒ¬ï¸', 'å‚¨èƒ½': 'ğŸ”‹',
    
    'åŒ»è¯åŒ»ç–—': 'ğŸ¥', 'åˆ›æ–°è¯': 'ğŸ§ª', 'åŒ»ç–—å™¨æ¢°': 'ğŸ©º', 'åŒ»ç–—æœåŠ¡': 'ğŸ‘¨â€âš•ï¸', 
    'ä¸­è¯': 'ğŸŒ¿', 'ç”Ÿç‰©ç–«è‹—': 'ğŸ’‰',
    
    'é‡‘è': 'ğŸ¦', 'é“¶è¡Œ': 'ğŸ§', 'åˆ¸å•†': 'ğŸ“ˆ', 'ä¿é™©': 'ğŸ›¡ï¸', 'æˆ¿åœ°äº§': 'ğŸ ',
    
    'å‘¨æœŸ': 'ğŸ”©', 'ç…¤ç‚­': 'ğŸŒ‘', 'é’¢é“': 'ğŸ—ï¸', 'æœ‰è‰²é‡‘å±': 'ğŸ”¶', 'åŒ–å·¥': 'ğŸ§ª',
    
    'é«˜ç«¯åˆ¶é€ ': 'âš™ï¸', 'å†›å·¥': 'ğŸš€', 'èˆªç©ºèˆªå¤©': 'ğŸ›°ï¸', 'å›½é˜²å†›å·¥': 'ğŸ›¡ï¸', 
    'èˆªå¤©å†›å·¥': 'ğŸ›°ï¸', 'æœºå™¨äºº': 'ğŸ¤–',
    
    # æ¦‚å¿µé£æ ¼
    'çº¢åˆ©': 'ğŸ’°', 'äººå·¥æ™ºèƒ½': 'ğŸ§ ', 'AI': 'ğŸ¤–', 'ç®—åŠ›': 'ğŸ¢', 
    'ESG': 'ğŸŒ±', 'ä¸­ç‰¹ä¼°': 'ğŸ›ï¸', 'å‡ºæµ·': 'ğŸŒ',
    
    # èµ„äº§åˆ†ç±»
    'æƒç›Šç±»': 'ğŸ“ˆ', 'å›ºæ”¶ç±»': 'ğŸ’µ', 'å•†å“ç±»': 'ğŸ†', 'REITs': 'ğŸ¢',
    
    # é»˜è®¤
    'å…¨éƒ¨': 'ğŸŒ', 'ç»¼åˆ': 'ğŸ“Š'
}


# ==================== ä¸»é¢˜åˆ†ç±»æ˜ å°„ ====================
THEME_CATEGORIES = {
    'ä¸»æµè¡Œä¸š': [
        'å¤§æ¶ˆè´¹', 'ç™½é…’', 'é£Ÿå“é¥®æ–™', 'å®¶ç”µ', 'ç¾å¦†', 'æ—…æ¸¸é…’åº—', 'å†œä¸šå…»æ®–',
        'ç§‘æŠ€TMT', 'åŠå¯¼ä½“èŠ¯ç‰‡', 'è®¡ç®—æœº', 'ç”µå­', 'é€šä¿¡', 'ä¼ åª’æ¸¸æˆ',
        'æ–°èƒ½æº', 'å…‰ä¼', 'æ–°èƒ½æºè½¦', 'é£ç”µ', 'å‚¨èƒ½',
        'åŒ»è¯åŒ»ç–—', 'åˆ›æ–°è¯', 'åŒ»ç–—å™¨æ¢°', 'åŒ»ç–—æœåŠ¡', 'ä¸­è¯', 'ç”Ÿç‰©ç–«è‹—',
        'é‡‘è', 'é“¶è¡Œ', 'åˆ¸å•†', 'ä¿é™©', 'æˆ¿åœ°äº§',
        'å‘¨æœŸ', 'ç…¤ç‚­', 'é’¢é“', 'æœ‰è‰²é‡‘å±', 'åŒ–å·¥',
        'é«˜ç«¯åˆ¶é€ ', 'å†›å·¥', 'èˆªç©ºèˆªå¤©', 'å›½é˜²å†›å·¥', 'æœºå™¨äºº'
    ],
    'æ¦‚å¿µé£æ ¼': [
        'çº¢åˆ©', 'äººå·¥æ™ºèƒ½', 'AI', 'ç®—åŠ›', 'ESG', 'ä¸­ç‰¹ä¼°', 'å‡ºæµ·'
    ],
    'èµ„äº§åˆ†ç±»': [
        'æƒç›Šç±»', 'å›ºæ”¶ç±»', 'å•†å“ç±»', 'REITs'
    ]
}


# ==================== ä¸»é¢˜å…³é”®è¯æ˜ å°„ ====================
THEME_KEYWORDS = {
    # ä¸»æµè¡Œä¸šæ¿å—
    'å¤§æ¶ˆè´¹': ['æ¶ˆè´¹', 'å•†è´¸', 'é›¶å”®', 'ä¼‘é—²', 'é¤é¥®', 'ä¹³ä¸š'],
    'ç™½é…’': ['ç™½é…’', 'é…’'],
    'é£Ÿå“é¥®æ–™': ['é£Ÿå“', 'é¥®æ–™'],
    'å®¶ç”µ': ['å®¶ç”µ', 'ç”µå™¨'],
    'ç¾å¦†': ['ç¾å¦†', 'æ´—æŠ¤', 'åŒ–å¦†å“', 'ä¸ªæŠ¤'],
    'æ—…æ¸¸é…’åº—': ['é…’åº—', 'æ—…æ¸¸'],
    'å†œä¸šå…»æ®–': ['å†œä¸š', 'å…»æ®–', 'çŒª', 'é¸¡'],
    
    'ç§‘æŠ€TMT': ['ç§‘æŠ€', 'TMT', 'ä¿¡æ¯', 'äº’è”ç½‘'],
    'åŠå¯¼ä½“èŠ¯ç‰‡': ['åŠå¯¼ä½“', 'èŠ¯ç‰‡', 'é›†æˆç”µè·¯', 'æ™¶åœ†'],
    'è®¡ç®—æœº': ['è®¡ç®—æœº', 'è½¯ä»¶', 'ä¿¡åˆ›', 'äº‘è®¡ç®—'],
    'ç”µå­': ['ç”µå­', 'å…ƒå™¨ä»¶'],
    'é€šä¿¡': ['é€šä¿¡', '5G', '6G'],
    'ä¼ åª’æ¸¸æˆ': ['ä¼ åª’', 'æ¸¸æˆ', 'å½±è§†', 'å¨±ä¹'],
    
    'æ–°èƒ½æº': ['æ–°èƒ½æº', 'æ¸…æ´èƒ½æº', 'ç»¿è‰²'],
    'å…‰ä¼': ['å…‰ä¼', 'å¤ªé˜³èƒ½'],
    'æ–°èƒ½æºè½¦': ['æ–°èƒ½æºè½¦', 'ç”µåŠ¨è½¦', 'æ±½è½¦', 'æ™ºèƒ½é©¾é©¶'],
    'é£ç”µ': ['é£ç”µ', 'é£èƒ½'],
    'å‚¨èƒ½': ['å‚¨èƒ½', 'ç”µæ± ', 'é”‚ç”µ'],
    
    'åŒ»è¯åŒ»ç–—': ['åŒ»è¯', 'åŒ»ç–—', 'å¥åº·'],
    'åˆ›æ–°è¯': ['åˆ›æ–°è¯', 'ç”Ÿç‰©åŒ»è¯', 'CXO'],
    'åŒ»ç–—å™¨æ¢°': ['åŒ»ç–—å™¨æ¢°', 'å™¨æ¢°'],
    'åŒ»ç–—æœåŠ¡': ['åŒ»ç–—æœåŠ¡', 'åŒ»é™¢'],
    'ä¸­è¯': ['ä¸­è¯', 'ä¸­åŒ»'],
    'ç”Ÿç‰©ç–«è‹—': ['ç–«è‹—', 'ç”Ÿç‰©'],
    
    'é‡‘è': ['é‡‘è', 'é“¶è¡Œ', 'è¯åˆ¸', 'ä¿é™©'],
    'é“¶è¡Œ': ['é“¶è¡Œ'],
    'åˆ¸å•†': ['åˆ¸å•†', 'è¯åˆ¸'],
    'ä¿é™©': ['ä¿é™©'],
    'æˆ¿åœ°äº§': ['æˆ¿åœ°äº§', 'åœ°äº§'],
    
    'å‘¨æœŸ': ['å‘¨æœŸ', 'èµ„æº', 'åŸºç¡€èƒ½æº', 'äº¤é€š', 'åŸºå»º'],
    'ç…¤ç‚­': ['ç…¤ç‚­'],
    'é’¢é“': ['é’¢é“'],
    'æœ‰è‰²é‡‘å±': ['æœ‰è‰²', 'é‡‘å±', 'é»„é‡‘', 'é“œ', 'é“'],
    'åŒ–å·¥': ['åŒ–å·¥', 'çŸ³åŒ–', 'ç‚¼åŒ–'],
    
    'é«˜ç«¯åˆ¶é€ ': ['åˆ¶é€ ', 'å·¥ä¸š', 'æ™ºé€ ', 'æ¯æœº', 'è£…å¤‡'],
    'å†›å·¥': ['å†›å·¥', 'å›½é˜²', 'èˆªç©º', 'èˆªå¤©'],
    'èˆªç©ºèˆªå¤©': ['èˆªç©º', 'èˆªå¤©', 'å«æ˜Ÿ', 'å¤§é£æœº'],
    'å›½é˜²å†›å·¥': ['å›½é˜²', 'å†›å·¥', 'æ­¦å™¨'],
    'æœºå™¨äºº': ['æœºå™¨äºº', 'æœºç”µ', 'å·¥ä¸šæ¯æœº'],
    
    # æ¦‚å¿µä¸é£æ ¼ä¸»é¢˜
    'çº¢åˆ©': ['çº¢åˆ©', 'é«˜è‚¡æ¯', 'è‚¡æ¯'],
    'äººå·¥æ™ºèƒ½': ['äººå·¥æ™ºèƒ½', 'AI', 'æ™ºèƒ½', 'ç®—åŠ›', 'å¤§æ¨¡å‹'],
    'AI': ['AI', 'äººå·¥æ™ºèƒ½', 'æ™ºèƒ½', 'ç®—åŠ›'],
    'ç®—åŠ›': ['ç®—åŠ›', 'æ•°æ®ä¸­å¿ƒ', 'IDC', 'æœåŠ¡å™¨'],
    'ESG': ['ESG', 'å¯æŒç»­', 'ç¢³ä¸­å’Œ', 'ç¯ä¿'],
    'ä¸­ç‰¹ä¼°': ['ä¸­ç‰¹ä¼°', 'å¤®ä¼', 'å›½ä¼'],
    'å‡ºæµ·': ['å‡ºæµ·', 'è·¨å¢ƒ', 'ä¸€å¸¦ä¸€è·¯'],
    
    # èµ„äº§åˆ†ç±»
    'æƒç›Šç±»': ['è‚¡ç¥¨', 'æ··åˆ', 'æˆé•¿', 'ä»·å€¼', 'æŒ‡æ•°'],
    'å›ºæ”¶ç±»': ['å€ºåˆ¸', 'çº¯å€º', 'åˆ©ç‡', 'ä¿¡ç”¨', 'çŸ­å€º', 'ä¸­çŸ­å€º'],
    'å•†å“ç±»': ['å•†å“', 'é»„é‡‘', 'ç™½é“¶', 'åŸæ²¹'],
    'REITs': ['REITs', 'ä¸åŠ¨äº§', 'åŸºç¡€è®¾æ–½']
}


# ==================== å€ºåˆ¸åŸºé‡‘å…³é”®è¯ ====================
BOND_FUND_KEYWORDS = [
    'å€º', 'çº¯å€º', 'çŸ­å€º', 'é•¿å€º', 'åˆ©ç‡å€º', 'ä¿¡ç”¨å€º',
    'ä¸­çŸ­å€º', 'çº¯å€º', 'å¢å¼ºå€º', 'åŒå€º', 'æ·»åˆ©', 'æ·»ç›Š',
    'ç¨³å¥', 'å®‰å¿ƒ', 'å®‰äº«', 'æœˆæœˆ', 'å­£å­£', 'å¹´å¹´'
]


# ==================== API å“åº”ç  ====================
class ResponseCode:
    SUCCESS = 200
    BAD_REQUEST = 400
    UNAUTHORIZED = 401
    NOT_FOUND = 404
    SERVER_ERROR = 500
    SERVICE_UNAVAILABLE = 503


# ==================== è¯„åˆ†æƒé‡é…ç½® ====================
SCORE_WEIGHTS = {
    # æ”¶ç›Šèƒ½åŠ› (40%)
    'alpha': 0.15,
    'alpha_consistency': 0.10,  # Alpha ç¨³å®šæ€§
    'annual_return': 0.15,
    
    # é£é™©æ§åˆ¶ (35%)
    'sharpe': 0.15,
    'max_drawdown': 0.10,       # è´Ÿå‘æŒ‡æ ‡
    'volatility': 0.05,         # è´Ÿå‘æŒ‡æ ‡
    'downside_deviation': 0.05, # ä¸‹è¡Œåå·®
    
    # ç›¸å¯¹è¡¨ç° (25%)
    'peer_percentile': 0.15,    # åŒç±»æ’å
    'win_rate': 0.05,
    'info_ratio': 0.05
}


# ==================== è¾…åŠ©å‡½æ•° ====================
def get_theme_icon(theme: str) -> str:
    """è·å–ä¸»é¢˜å¯¹åº”çš„å›¾æ ‡"""
    if theme in THEME_ICONS:
        return THEME_ICONS[theme]
    
    # æ¨¡ç³ŠåŒ¹é…
    for key, icon in THEME_ICONS.items():
        if key in theme or theme in key:
            return icon
    
    return 'ğŸ“Š'  # é»˜è®¤å›¾æ ‡


def get_theme_category(theme: str) -> str:
    """è·å–ä¸»é¢˜æ‰€å±åˆ†ç±»"""
    for category, themes in THEME_CATEGORIES.items():
        if theme in themes:
            return category
    return 'å…¶ä»–'


def match_themes_by_name(fund_name: str) -> list:
    """æ ¹æ®åŸºé‡‘åç§°åŒ¹é…ä¸»é¢˜"""
    matched = []
    for theme, keywords in THEME_KEYWORDS.items():
        for keyword in keywords:
            if keyword in fund_name:
                matched.append(theme)
                break
    return matched if matched else ['ç»¼åˆ']


def is_bond_fund(fund_name: str) -> bool:
    """åˆ¤æ–­æ˜¯å¦ä¸ºå€ºåˆ¸åŸºé‡‘"""
    return any(kw in fund_name for kw in BOND_FUND_KEYWORDS)
